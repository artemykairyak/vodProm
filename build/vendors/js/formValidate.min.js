"use strict";function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _classCallCheck(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var l=t[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function formValidate(e){new validateForm(e)}var globalVars={counter:0,inputFirst:!1,labelFirst:!1,inputsArray:[],amountFiles:0};function reloadFiles(e){var t=e.form,r=e.target,l=t.querySelectorAll('input[type="file"]'),i=!1,a="",s="";l[0].files[0]&&l[0].classList.remove("error");var n=document.createElement("label");l[0].getAttribute("data-role").includes("required")&&(i=!0);var o=l[l.length-1];r.nextElementSibling&&"LABEL"===r.nextElementSibling.tagName?(s=e.addText?e.addText:r.nextElementSibling.innerHTML,n=r.nextElementSibling,a=r.files[0].name,globalVars.inputFirst=!0):r.previousElementSibling&&"LABEL"===r.previousElementSibling.tagName?(n=r.previousElementSibling,s=e.addText?e.addText:r.previousElementSibling.innerHTML,globalVars.labelFirst=!0,a=r.files[0].name,o.files[0]=""):console.log("Structure error. Must be <input><label> or <label><input>"),n.innerHTML=a,globalVars.counter=++globalVars.counter;var u=l[0].getAttribute("id"),c=l[0].getAttribute("name"),m=document.createElement("input");m.setAttribute("name",c),m.setAttribute("type","file"),m.setAttribute("data-role","file");var b=m.getAttribute("name"),d=String(globalVars.counter)+b,f=(m.getAttribute("id"),String(globalVars.counter)+u);if(m.setAttribute("ID",f),m.setAttribute("name",d),globalVars.inputFirst&&globalVars.amountFiles<=e.limit){r.after(n),n.after(m);var p=document.createElement("label");if(p.innerHTML=s,p.setAttribute("for",f),m.after(p),globalVars.amountFiles=++globalVars.amountFiles,globalVars.amountFiles===e.limit){var h=t.querySelectorAll('input[type="file"]');h[h.length-1].setAttribute("disabled","")}}else if(globalVars.labelFirst&&globalVars.amountFiles<=e.limit){var g=document.createElement("label");if(g.setAttribute("for",f),g.innerHTML=s,r.after(g),r.nextElementSibling.after(m),globalVars.amountFiles=++globalVars.amountFiles,globalVars.amountFiles===e.limit){var y=t.querySelectorAll('input[type="file"]');y[y.length-1].setAttribute("disabled","")}}l.forEach(function(r){globalVars.inputsArray.includes(r)||(globalVars.inputsArray.push(r),r.addEventListener("click",function(a){globalVars.inputFirst&&a.target.files&&(a.preventDefault(),r.nextElementSibling&&r.nextElementSibling.remove(),delete r.files[0],r.remove(),globalVars.amountFiles=--globalVars.amountFiles,globalVars.amountFiles===e.limit?t.querySelectorAll('input[type="file"]')[t.querySelectorAll('input[type="file"]').length-1].setAttribute("disabled",""):t.querySelectorAll('input[type="file"]')[t.querySelectorAll('input[type="file"]').length-1].removeAttribute("disabled","")),globalVars.labelFirst&&a.target.files&&(globalVars.inputsArray.includes(r)||globalVars.inputsArray.push(r),a.preventDefault(),r.previousElementSibling&&r.previousElementSibling.remove(),delete r.files[0],r.remove(),globalVars.amountFiles=--globalVars.amountFiles,globalVars.amountFiles===e.limit?t.querySelectorAll('input[type="file"]')[t.querySelectorAll('input[type="file"]').length-1].setAttribute("disabled",""):t.querySelectorAll('input[type="file"]')[t.querySelectorAll('input[type="file"]').length-1].removeAttribute("disabled","")),1===l.length&&i&&t.querySelectorAll('input[type="file"]')[0].setAttribute("data-role","file required")}))})}var validateForm=function(){function e(t){_classCallCheck(this,e),this.form=t.form,this.length=t.form.children.length,this.errors=[],this.passwordRegExp=t.passwordRegEx||/^.{6,}$/,this.emailRegExp=t.emailRegExp||/^[-._a-zA-Z0-9]+@(?:[a-z0-9][-a-z0-9]+\.)+[a-z]{2,6}$/,this.phoneRegExp=t.phoneRegExp||/^(\s*)?(\+)?([- _():=+]?\d[- _():=+]?){6,14}(\s*)?$/,this.url=t.url,this.onLoadStart=t.onLoadStart||function(){},this.onSuccess=t.onSuccess||function(){},this.onError=t.onError||function(){},this.errorClass=t.errorClass||"error",this.customFields=t.customFields||[],this.data=null,this.error=null,this.validation()}return _createClass(e,[{key:"validation",value:function(){var e=this;this.errors=[];for(var t=this.form.querySelectorAll("input"),r=0;r<t.length;r++)if("button"!==t[r].type&&"submit"!==t[r].type){var l=t[r].getAttribute("data-role").includes("required");l&&""===t[r].value||l&&t[r].getAttribute("data-role").includes("checkbox")&&!t[r].checked?this.errors.push(t[r]):t[r].getAttribute("data-role").includes("phone")?this.phoneValidation(t[r]):t[r].getAttribute("data-role").includes("email")?this.emailValidation(t[r]):t[r].getAttribute("data-role").includes("password")?this.passwordValidation(t[r]):t[r].classList.remove(this.errorClass);for(var i=0;i<this.customFields.length;i++)t[r].getAttribute("data-role").includes(this.customFields[i].dataRole)&&this.customFieldValidation(t[r],this.customFields[i].regExp)}if(this.errors.length)this.errors.forEach(function(t){return t.classList.add(e.errorClass),!1});else{var a=!1;t.forEach(function(e){if(e.classList.contains("error"))return a=!0,!1}),a||this.sendInfo(this.url)}}},{key:"customFieldValidation",value:function(e,t){return e.value.match(t)?(e.classList.remove(this.errorClass),!0):(this.errors.push(e),e.classList.add(this.errorClass),!1)}},{key:"phoneValidation",value:function(e){return e.value.match(this.phoneRegExp)?(e.classList.remove(this.errorClass),!0):(this.errors.push(e),!1)}},{key:"emailValidation",value:function(e){return e.value.match(this.emailRegExp)?(e.classList.remove(this.errorClass),!0):(this.errors.push(e),!1)}},{key:"passwordValidation",value:function(e){return e.value.match(this.passwordRegExp)?(e.classList.remove(this.errorClass),!0):(this.errors.push(e),!1)}},{key:"cleanForm",value:function(){if(this.form.reset(),this.form.querySelector('input[type="file"]')){for(var e=this.form.querySelector('input[type="file"]'),t=(e.cloneNode(!1),this.form.querySelectorAll('input[type="file"]')),r=(e.previousElementSibling,0);r<t.length-1;r++)globalVars.labelFirst?(t[r].previousElementSibling.remove(),t[r].remove()):(t[r].nextElementSibling.remove(),t[r].remove());this.form.querySelectorAll('input[type="file"]')[form.querySelectorAll('input[type="file"]').length-1].removeAttribute("disabled",""),globalVars.inputFirst&&(this.form.querySelectorAll('input[type="file"]').nextElementSibling.innerHTML=""),globalVars.inputsArray=[],globalVars.amountFiles=0,globalVars.counter=0}}},{key:"sendInfo",value:function(e){var t=this,r=new FormData(this.form);this.form.querySelector('input[type="submit"]').setAttribute("disabled",""),this.onLoadStart(),fetch(e,{method:"post",body:r}).then(function(e){return e.json()}).then(function(e){t.data=e,t.onSuccess(),t.cleanForm(),t.form.querySelector('input[type="submit"]').removeAttribute("disabled")}).catch(function(e){t.error=e,t.onError(),t.form.querySelector('input[type="submit"]').removeAttribute("disabled")})}}]),e}();